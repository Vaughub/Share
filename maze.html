<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>

        table {
            border-spacing: 0;
        }
        td {
            background-color: white;
            padding: 0;
        }
        td.room {
            width: 40px;
            height: 40px;
        }
        td.wall {
            background-color: black;
        }
        td.noWall {
            background-color: white;
        }
        td.small {
            width: 10px;
            height: 10px;
        }
        td.wide {
            width: 40px;
        }
        td.high {
            height: 40px;
        }

    </style>
</head>
<body>

    <div id="content"></div>

    <script>

        let contentDiv = document.getElementById('content');

        // model
        let random = Math.floor(Math.random() * 10) + 3;
        let labo = initModel(random);

        // view
        updateView();
        function updateView() {
            let tableTr = '';
            makeEscape();
            for(let i = 0; i < labo.rows.length; i++) {
                tableTr += `<tr>${wallMaker(i)}</tr>`;
            }
            contentDiv.innerHTML = `
            <table>
                ${tableTr}
            </table>
            `;
        }

        function wallMaker(index) {
            let html = '';
            for(let i = 0; i < labo.rows.length; i++) {
                html += `
                <td onclick="clicked(${i},${index})" class="${labo.rows[index][i].isOpen ? 'noWall' : labo.rows[index][i].type}"></td>
                `;
            }
            return html;
        }

        // controller
        function initModel(index) {
            let model = {
                size: index,
                rows: modelAllWalls(index)
            }
            return model;
        }

        function modelAllWalls(index) {
            let allWalls = [];
            for(let i = 0; i < index*2 + 1; i++) {
                allWalls[i] = modelWalls(index, i);
            }
            return allWalls;
        }

        function modelWalls(index, allWallsIndex) {
            let walls = [];
            for(let i = 0; i < index + (index + 1); i++) {
                walls[i] = {type: whatWall(i, allWallsIndex), isOpen: checkStatus(i, allWallsIndex)}
            }
            return walls;
        } 

        function whatWall(index, allWallsIndex) {
            if (allWallsIndex%2 == 0) {
                return index%2 == 0 ? 'small wall' : 'wide wall'; 
            } else {
                return index%2 == 0 ? 'high wall' : 'room';
            }
        }

        function checkStatus(y, x) {
            
            if (x == 0) return false;
            else if (x < random*2) {
                let r = Math.floor(Math.random() * 2);
                if (y == 0) return false;
                else if (y == random*2) return false;
                if (r == 0) return true;
                return false;
            }
            return false;
        }

        function makeEscape() {
            let randomA = Math.floor(Math.random() * (random*2))
            let randomB = Math.floor(Math.random() * (random*2))
            let randomC = Math.floor(Math.random() * 2);
            if (randomA%2 == 0) randomA += 1
            if (randomB%2 == 0) randomB += 1
            // y, x
            if (randomC == 1) {
                labo.rows[randomB][0].isOpen = true;
                labo.rows[randomA][random*2].isOpen = true;
            } else {
                labo.rows[0][randomA].isOpen = true;
                labo.rows[random*2][randomB].isOpen = true;
            }
        }

        function clicked(x, y) {
            labo.rows[y][x].isOpen = labo.rows[y][x].isOpen ? false : true;
            updateView();
        }
   
    </script>
    
</body>
</html>